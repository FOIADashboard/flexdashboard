---
title: "FOIA Annual Report dashboard"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    #source_code: embed
    theme:
      version: 4
      bootswatch: lux
---

```{r global}
# configuartion chunk for the dashboard. Here you will find variables 
# that chooses which agencies and components are available.

# Loads necessary packages for dashboard functionality.
# If any package is missing, it will be installed on the fly.
all_packages <- c("flexdashboard", "shiny", "knitr", "kableExtra",
                  "dplyr", "ggplot2", "plotly", "tidyr",
                  "stringr", "readr", "scales", "purrr", 
                  "DT")
for (p in all_packages) {
  if (!(p %in% installed.packages()[,"Package"])) {
    install.packages(p)
  }
}

# Load all required libraries.
library(flexdashboard)
library(shiny)
library(knitr)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(plotly)
library(tidyr)
library(ggplot2)
library(stringr)
library(readr)
library(purrr)
library(DT)
library(readxl)

# load functions used in script
source("functions.R")

# dashboard variable setup ------------------------------------ 

# agencies with extracted FOIA data. To extract data, use 
# the FOIA data extraction tool:
# https://github.com/rcds-dssv/foia_data_mining
# After extraction, move the resulting .rds file to data/rds.
# The .rds file should be saved as {agency}_data.rds
agencies <- c(
  "Central Intelligence Agency" = "CIA",
  "Department of Homeland Security" = "DHS",
  "Department of Commerce" = "DOC",
  "Department of Defense" = "DOD",
  "Department of Education" = "ED",
  "Department of Energy" = "DOE",
  "Department of the Interior" = "DOI",
  "Department of Health and Human Services" = "HHS",
  "Department of Housing and Urban Development" = "HUD",
  "Department of Justice" = "DOJ", 
  "Department of Labor" = "DOL", 
  "Department of State" = "DOS",
  "Department of Transportation" = "DOT",
  "Department of the Treasury" = "Treasury",  
  "Department of Veterans Affairs" = "VA",
  "Environmental Protection Agency" = "EPA",
  "Federal Trade Commission" = "FTC",
  "General Services Administration" = "GSA",
  "Securities and Exchange Commission" = "SEC",
  "Social Security Administration" = "SSA",
  "U.S. Agency for International Development" = "USAID",  
  "U.S. Department of Agriculture" = "USDA")

# Dictionary mapping agencies to their subcomponents.
# Used to populate component selection UI.
component_list <- list(
  "DHS" = c("CBP", "CRCL", "FEMA", "FLETC", "FPS", "I&A", "ICE", "OIG", "PRIV",
            "TSA", "USCG", "USCIS", "USSS"),
  "EPA" = c("HQ", "Region 1", "Region 2", "Region 3", "Region 4", "Region 5",
            "Region 6", "Region 7", "Region 8", "Region 9", "Region 10"),
  "DOL" = c("ETA", "OASP", "OCIA", "OIG", "OPA", "OSEC", "OSHA", "SOL", "WHD"),
  "DOJ" = c("BOP", "Civil Rights", "DEA", "EOIR", "FBI", "OIG", "OIP"),
  "HHS" = c("ACF", "CDC", "CMS", "FDA", "NIH", "OIG", "OS"),
  "DOS" = c("DoS", "OIG")
)

# Agencies for which budget data is available in Excel
# Each sheet should represent an agency (in the acronym format).
agencies_budget <- c(
  "Department of Homeland Security" = "DHS", 
  "Department of Justice" = "DOJ", 
  "Department of Labor" = "DOL", 
  "Department of State" = "DOS", 
  "Department of Health and Human Services" = "HHS"
)

# Dictionary mapping agencies to their subcomponents for budget data.
# Used to populate component selection UI for budget plots.
component_budget_list <- list(
  "DHS" = c(
    "Customs and Border Protection" = "CBP", 
    "Office for Civil Rights and Civil Liberties" = "CRCL", 
    "Immigrations and Customs Enforcement" = "ICE", 
    "Department of Homeland Security Office of the Inspector General" = "OIG", 
    "DHS Privacy Office" = "PRIV", 
    "U.S. Citizenship and Immigration Services" = "USCIS"
  ),
  "DOL" = c(
    "Department of Labor Security Office of the Inspector General" = "OIG", 
    "Department of Labor Office of the Secretary" = "OSEC", 
    "Occupational Safety and Health Administration" = "OSHA", 
    "Wage and Hour Division" = "WHD"
  ),
  "DOJ" = c(
    "Executive Office for Immigration Review" = "EOIR",
    "Department of Justice Office of the Inspector General" = "OIG"
  ),
  "HHS" = c(
    "Administration for Children and Families" = "ACF",
    "Centers for Disease Control and Prevention" = "CDC",
    "Health and Human Services Office of the Inspector General" = "OIG"
  ),
  "DOS" = c(
    "Department of State Office of the Inspector General" = "OIG",
    "Department of State" = "DoS"
  )
)

# UI, data selection, plot output configuration ----------------------------

# Possible sections for FOIA data
# The vector is formmated such that
# c("Name to display in dropdown" = "section_name", ...)
section_choices <- c(
  "Appeal Disposition" = "AppealDispositionSection",
  "Backlog" = "BacklogSection",
  "Expedited Processing" = "ExpeditedProcessingSection",
  "Pending Perfected Requests" = "PendingPerfectedRequestsSection",  
  "Personnel and Cost" = "PersonnelAndCostSection",
  "Processed Request" = "ProcessedRequestSection"
)
selected_section_on_startup <- "PersonnelAndCostSection"

# define options for selected section
# Name in the list is the section name to access the data frame
# The vector (element of the list) is formatted such that
# c("Name to display in dropdown" = "column_name", ...)
variable_choice_list <- list(
  "PersonnelAndCostSection" = c(
    "Full Time" = "FullTimeEmployeeQuantity",
    "Equivalent Full Time" = "EquivalentFullTimeEmployeeQuantity",
    "Total Full Time Staff" = "TotalFullTimeStaffQuantity",
    "Processing Expenditure" = "ProcessingCostAmount",
    "Litigation Cost" = "LitigationCostAmount",
    "Total Cost" = "TotalCostAmount"),
  "BacklogSection" = c(
    "Backlogged Requests" = "BackloggedRequestQuantity"),
  "ExpeditedProcessingSection" = c(
    "Requests Granted" = "RequestGrantedQuantity",
    "Requests Denied" = "RequestDeniedQuantity",
    "Adjudication Median" = "AdjudicationMedianDaysValue",
    "Adjudication Avg. Days" = "AdjudicationAverageDaysValue",
    "Within Ten Days" = "AdjudicationWithinTenDaysQuantity"),
  "ProcessedRequestSection" = c(
    "Pending FY Start" = "ProcessingStatisticsPendingAtStartQuantity",
    "Pending FY End" = "ProcessingStatisticsPendingAtEndQuantity",
    "Requests Received" = "ProcessingStatisticsReceivedQuantity",
    "Requests Processed" = "ProcessingStatisticsProcessedQuantity"),
  "PendingPerfectedRequestsSection" = c(
    "Simple Pending Requests" = "SimplePendingRequestStatistics_PendingRequestQuantity",
    "Simple Median Days" = "SimplePendingRequestStatistics_PendingRequestMedianDaysValue",
    "Simple Average Days" = "SimplePendingRequestStatistics_PendingRequestAverageDaysValue",
    "Complex Pending Requests" = "ComplexPendingRequestStatistics_PendingRequestQuantity",
    "Complex Median Days" = "ComplexPendingRequestStatistics_PendingRequestMedianDaysValue",
    "Complex Average Days" = "ComplexPendingRequestStatistics_PendingRequestAverageDaysValue",
    "Expedited Pending Requests" = "ExpeditedPendingRequestStatistics_PendingRequestQuantity",
    "Expedited Median Days" = "ExpeditedPendingRequestStatistics_PendingRequestMedianDaysValue",
    "Expedited Average Days" = "ExpeditedPendingRequestStatistics_PendingRequestAverageDaysValue"),
  "AppealDispositionSection" = c(
    "Affirmed On Appeal" = "AppealDispositionAffirmedQuantity",
    "Partially Affirmed On Appeal" = "AppealDispositionPartialQuantity",
    "Reversed On Appeal" = "AppealDispositionReversedQuantity",
    "Appeal Closed - Other" = "AppealDispositionOtherQuantity",
    "Number of Appeals" = "AppealDispositionTotalQuantity")
)

# define manual title for each section
# Name in the list is the section name to access the data frame
# The vector (element of the list) is formatted such that
# c(column_name = "Manual Title", ...)
manual_title_list <- list(
  "PersonnelAndCostSection" = c(
    "FullTimeEmployeeQuantity" = "Full Time Employees",
    "EquivalentFullTimeEmployeeQuantity" = "Equivalent Full Time Employees",
    "TotalFullTimeStaffQuantity" = "Total Full Time Staff",
    "ProcessingCostAmount" = "Processing Expenditures",
    "LitigationCostAmount" = "Litigation Costs",
    "TotalCostAmount" = "Total Costs"
  ),
  "ExpeditedProcessingSection" = c(
    "RequestGrantedQuantity" = "Requests Granted",
    "RequestDeniedQuantity" = "Requests Denied",
    "AdjudicationMedianDaysValue" = "Median Adjudication (Days)",
    "AdjudicationAverageDaysValue" = "Average Adjudication (Days)",
    "AdjudicationWithinTenDaysQuantity" = "Requests Adjudicated Within Ten Days"
  ),
  "ProcessedRequestSection" = c(
    "ProcessingStatisticsPendingAtStartQuantity" = "Requests Pending at FY Start",
    "ProcessingStatisticsPendingAtEndQuantity" = "Requests Pending at FY End",
    "ProcessingStatisticsReceivedQuantity" = "Requests Received",
    "ProcessingStatisticsProcessedQuantity" = "Requests Processed"
  ),
  "PendingPerfectedRequestsSection" = c(
    "SimplePendingRequestStatistics_PendingRequestQuantity" = "Simple Pending Requests",
    "SimplePendingRequestStatistics_PendingRequestMedianDaysValue" = "Simple Median Days",
    "SimplePendingRequestStatistics_PendingRequestAverageDaysValue" = "Simple Average Days",
    "ComplexPendingRequestStatistics_PendingRequestQuantity" = "Complex Pending Requests",
    "ComplexPendingRequestStatistics_PendingRequestMedianDaysValue" = "Complex Median Days",
    "ComplexPendingRequestStatistics_PendingRequestAverageDaysValue" = "Complex Average Days",
    "ExpeditedPendingRequestStatistics_PendingRequestQuantity" = "Expedited Pending Requests",
    "ExpeditedPendingRequestStatistics_PendingRequestMedianDaysValue" = "Expedited Median Days",
    "ExpeditedPendingRequestStatistics_PendingRequestAverageDaysValue" = "Expedited Average Days"),
  "AppealDispositionSection" = c(
    "AppealDispositionAffirmedQuantity" = "Affirmed on Appeal",
    "AppealDispositionPartialQuantity" = "Partially Affirmed on Appeal",
    "AppealDispositionReversedQuantity" = "Reversed on Appeal",
    "AppealDispositionOtherQuantity" = "Appeals Closed for Other Reasons",
    "AppealDispositionTotalQuantity" = "Number of Appeals")
)

# Fiscal year range for the FOIA data.
fiscal_year_range <- c(10, 23)
```

```{r setup-foia}
# Run specific functions and code necessary for the dashboard

# Load the data. The data should be saved in the data/rds folder for foia data
# and "FOIA Dashboard Government Budget.xlsx" for budget data.
# Few things happen in the load functions. It reads the rds and excel files for the agencies
# specified in the "agencies" and "agencies_budget" variables.
# List of data frames is created. Then this list is saved as a rds file in the
# project directory (foia_data.rds and budget_data.rds). These files are used
# for publishing the dashboard to shinyapps.io. It is designed this way because
# individual files have to be selected when publishing the app.

# `load_foia_data` reads .rds files from data/rds for each agency.
# if run locally, it will read the files from data/rds and save the object 
# as `foia_data.rds`
master_foia_data <- load_foia_data(agencies)

# `load_all_agencies_budget` reads .xlsx budget file from data/.
# if run locally, it will read the "FOIA Dashboard Government Budget.xlsx" file and save the object
# as `budget_data.rds`
master_budget_data <- load_all_agencies_budget(agencies_budget)

# If any agency in `agencies` lacks a component list, derive it from its data.
for (agency in agencies) {
  if (!(agency %in% names(component_list))) {
    component_list[[agency]] <- extract_agency_components(master_foia_data[[agency]])
  }
}
```


Annual Report Data, 2010 -
=====================================

Inputs {.sidebar}
-----------------------------------

```{r foia_metrics_ui}
# UI for selecting the FOIA section (e.g., Personnel and Cost, Backlog, etc.)
radioButtons(
  "section_input",
  label="Section",
  choices=section_choices,
  selected=selected_section_on_startup,
)

# UI for selecting the agency (e.g., DHS, EPA)
selectInput(
  "agency_input",
  "Department", 
  choices =  agencies, 
  selected = "DHS")

# UI for selecting a variable from the selected section.
selectInput(
  "variable_select_input",
  "Data",
  choices = variable_choice_list[[selected_section_on_startup]],
  selected = variable_choice_list[[selected_section_on_startup]][1])

# UI for selecting one or more components (e.g., CBP, ICE)
checkboxGroupInput(
  "component_input",
  "Agency",
  choices = component_list[["DHS"]], 
  selected = component_list[["DHS"]][c(1,2)])

# UI for selecting a range of fiscal years (FY10 to FY23)
sliderInput(
  "fy_input",
  "FY", 
  min = fiscal_year_range[1], 
  max = fiscal_year_range[2], 
  value = fiscal_year_range, 
  step = 1,
  sep = "")

# Footer with information about the dashboard
HTML(
  "
  <div style=\"font-size: smaller; word-break: break-word; overflow-wrap: break-word;\">
    Jacqueline Stevens and Kendall McKay, FOIA Dashboard,
    <a href=\"https://deportationresearch.shinyapps.io/FOIAdashboard/\">https://deportationresearch.shinyapps.io/FOIAdashboard/</a>
    <br><br>
    Copyright:
    <a href=\"https://creativecommons.org/licenses/by-nc/4.0/\">CC BY-NC</a>
  </div>
  ")
```

Row
-------------------------------------

### Plot

```{r foia_metrics_server}
# Reactive expressions to capture UI inputs.
# The input IDs correspond to the UI elements defined above.
section <- reactive({
  input$section_input
})
agency <- reactive({
  input$agency_input
})
component <- reactive({
  input$component_input
})
fy <- reactive({
  input$fy_input[1]:input$fy_input[2]
})
variable <- reactive({
  input$variable_select_input
})

# Filters the data for selected agency and section.
filtered_data <- reactive({
  req(agency())
  master_foia_data[[agency()]][[section()]]
})

# When section changes, update the variable dropdown to reflect relevant choices.
observe({
  req(section())
  updateSelectInput(
    session, "variable_select_input", "Data",
    choices = variable_choice_list[[section()]],
    selected = variable_choice_list[[section()]][[1]]
  )
})

# When agency changes, update the component checkboxes with default selection.
observe({
  req(agency())
  comp_preselected_ <- if (length(component_list[[agency()]]) > 1) c(1,2) else 1
  updateCheckboxGroupInput(
    session, "component_input", "Agency",
    choices = component_list[[agency()]],
    selected = component_list[[agency()]][comp_preselected_]
  )
})

# Retrieves a manual display title for the selected variable (if available)
filtered_input_manual_title <- reactive({
  req(variable())
  req(section())
  if (section() %in% names(manual_title_list)) {
    manual_title_list[[section()]][[variable()]]
  } else {
    # Return NULL if section not found
    return(NULL)
  }
})

# Generates the plot using the filtered data and selected parameters.
renderPlotly({
  if ((variable() %in% colnames(filtered_data())) &
      (any(component() %in% filtered_data()$OrganizationAbbreviationText))) {
    plot_single_column(
      isolate(filtered_data()),
      variable(),
      component(),
      fy(),
      manual_title = filtered_input_manual_title()
    )
  }
})
```

Foia Budget / Agency Budget
=====================================

Inputs {.sidebar}
-----------------------------------

<br/>

```{r budgets_ui}
# Dropdown to select agency for budget plots
selectInput(
  "agency_input_b",
  label = "Department", 
  choices =  agencies_budget, 
  selected = "DHS")

# Dropdown to select component (auto-updated based on agency)
selectInput(
  "component_input_b",
  label = "Agency",
  choices = component_budget_list[["DHS"]], 
  selected = component_budget_list[["DHS"]][c(1,2)])

# Choose type of plot to display: budget, budget vs backlog, or public affairs comparison
radioButtons(
  "plot_input_b",
  label = "Plot",
  # only has one selection for now... this can be modified when public affairs / 
  # expenditures section is added
  # choices = c("Budget" = "Budget", 
  #             "Budgets Ratio and Backlogged Requests" = "budget_v_backlog", 
  #             "Public Affairs vs Budget" = "publicaffairs_v_budget"),
  choices = c("Budgets Ratio and Backlogged Requests" = "budget_v_backlog"),
  selected = "budget_v_backlog")

# Fiscal year selector for budget plot
sliderInput(
  "fy_input_b",
  "FY", 
  min = fiscal_year_range[1], 
  max = fiscal_year_range[2], 
  value = fiscal_year_range, 
  step = 1,
  sep = "")

# Footer with information about the dashboard
HTML(
  "
  <div style=\"font-size: smaller; word-break: break-word; overflow-wrap: break-word;\">
    <span style='font-size: medium; font-weight: bold;'>
      The sources for the budget data are accessible 
      <a href=\"https://docs.google.com/spreadsheets/d/1CV6Z_gTZ0KVZ84ChH9lS88vAB-SyuqvRFO_Mavl7NDw/edit?usp=sharing\">here</a>.
    </span>
    <br><br>
    Jacqueline Stevens and Kendall McKay, FOIA Dashboard,
    <a href=\"https://deportationresearch.shinyapps.io/FOIAdashboard/\">https://deportationresearch.shinyapps.io/FOIAdashboard/</a>
    <br><br>
    Copyright:
    <a href=\"https://creativecommons.org/licenses/by-nc/4.0/\">CC BY-NC</a>
  </div>
  ")
```

Row {data-height=400}
-------------------------------------

### Plot - Select Plot Using Sidebar

```{r budgets_server, results='asis'}
# Reactive expressions to capture UI inputs for budget plots.
agency_b <- reactive({
  input$agency_input_b
})
component_b <- reactive({
  if (input$component_input_b == "DoS") {
    return("DOS_main")
  } else {
    return(input$component_input_b)
  }
})
fy_b <- reactive({
  input$fy_input_b[1]:input$fy_input_b[2]
})

# Extract budget data for selected agency
filtered_data_b <- reactive({
  req(agency_b())
  master_budget_data[[agency_b()]]
})

# Update component dropdown if agency changes
observe({
  req(agency_b())
  updateSelectInput(
    session, "component_input_b", "Agency",
    choices = component_budget_list[[agency_b()]],
    selected = component_budget_list[[agency_b()]][1]
  )
})

# Fiscal years as character vector formatted to match column headers in budget data.
agencyBudget_year <- reactive({
  paste0("20", fy_b())
})

# Plot for component budget over time.
budget_plot <- reactive({
  filtered_input_b <- paste0(component_b(), "_budget")
  
  # temporary solution to missing budget column name (some missing underscore)
  if (!(filtered_input_b %in% colnames(filtered_data_b()))) {
    plot_colname <- str_replace(filtered_input_b, "_", ".")
  } else {
    plot_colname <- filtered_input_b
  }
  
  if (plot_colname %in% colnames(filtered_data_b())){
    plot_budget_metrics(
      filtered_data_b(),
      plot_colname,
      agencyBudget_year(),
      selected_agency = agency_b(),
      selected_component = component_b(),
    )
  } else {
    warning(str_glue("Column {plot_colname} not found in dataset."))
    return(plot_no_data())
  }
})

# create ratio vs backlog plot title
ratio_v_backlog_title <- reactive({
  comp_names <- component_budget_list[[agency_b()]]
  names(comp_names)[comp_names == input$component_input_b]
})

# Plot comparing budget ratio vs backlog
budget_v_backlog_plot <- reactive({
  plot_ratio_v_backlog(
    filtered_data_b(),
    component_b(),
    agencyBudget_year(),
    line_colors = RColorBrewer::brewer.pal(4, "Dark2")[c(1,2)],
    plot_title = ratio_v_backlog_title()
  )
})

# Plot public affairs / foia expenditure ratio
publicaffairs_ratio_plot <- reactive({
  plot_publicaffairs_ratio(
    filtered_data_b(),
    component_b(),
    agencyBudget_year()
  )
})

# Renders the selected plot based on radio button input
renderPlotly({
  if (input$plot_input_b == "Budget") {
    budget_plot()
  } else if (input$plot_input_b == "budget_v_backlog") {
    budget_v_backlog_plot()
  } else if (input$plot_input_b == "publicaffairs_v_budget") {
    publicaffairs_ratio_plot()
  } else {
    ggplotly(ggplot() + geom_blank() + 
      ggtitle("No data available for this agency/component."))
  }
})
```

Row {data-height=200}
-------------------------------------

### Table

```{r}
# Renders the raw budget data table with improved formatting
renderDT(datatable(
  filtered_data_b(),
  options = list(
    lengthChange = FALSE,
    searching = FALSE,
    scrollX = TRUE,
    paging = FALSE,
    info = FALSE,
    columnDefs = list(list(
      targets = "_all", className = "dt-nowrap"
    )),
    # more compact row
    rowCallback = JS(
        "function(row, data, index) {",
        "  $('td', row).css({'padding-top': '4px', 'padding-bottom': '4px', 'line-height': '1'});",
        "}"
      )
  )
))
```


ABOUT
=====================================

Row {data-height=200}
-------------------------------------

### USAGE GUIDE

The <a href="https://deportation-research.buffett.northwestern.edu/">Deportation Research Clinic's</a> dashboard displays the data from the Freedom of Information Act (FOIA) Annual Reports released each year by federal agencies and their components. 
The sources for the department and component annual budgets data are available <a href="https://www.justice.gov/oip/reports-1">here</a>.

Please select sections, data type, component agency(s), and fiscal year(s) using the sidebar.

For more information about the FOIA, see <a href="https://www.foia.gov">foia.gov</a>.

Row {data-height=600}
-------------------------------------

### DATA SOURCES

Data on the FOIA Dashboard is from the United States’ Department of Justice’s [Annual FOIA Report Handbook.](https://www.justice.gov/media/1031511/dl?inline=) For more information, see the [DOJ's 2023 Training slides](https://www.justice.gov/d9/2023-10/refresher_training_for_annual_and_quarterly_foia_report_-_oct._2023.pdf) for the Annual Reports.

*DATA COLLECTION*

XML versions of the data were downloaded from individual agency websites, cleaned and processed through R, and uploaded and visualized to this dashboard. For more information, see the [Annual Reports.](https://www.justice.gov/oip/reports-1)

*ABOUT THE SECTIONS*

This dashboard includes data taken from the United States’ Freedom of Information Act (FOIA) Annual Reports compiled by federal agencies.

*PERSONNEL/COST*

*Full-Time:* The number of full-time FOIA employees. A “full-time FOIA employee” is a full-time employee who performs FOIA duties 100% of the time.

*Equivalent Full Time:* The number of equivalent full-time FOIA employees. This includes employees performing less than full-time FOIA duties that are either: (1) part-time employees who perform FOIA duties less than 100% of the time, or (2) full-time employees who perform FOIA duties less than 100% of the time. An “equivalent full-time FOIA employee” is created by adding together the percentages of time dedicated to FOIA duties by employees performing less than full-time FOIA work. Each time 100% is reached, the time expended is counted as one “equivalent full-time FOIA employee.” The number of such “equivalent” employees is reported in this category.

*Total Full Time Staff:* The combined total of full-time FOIA employees and equivalent full-time employees. Automatically populated for agencies using the 2009 Annual Report Tool to create their NIEM-XML. 

*Processing Expenditure:* The government data classified as 'processing costs' is labeled here as 'processing expenditures' because the amounts spent are not commensurate with the actual costs of complying with the FOIA statute and the government label is therefore misleading. The sum of all costs expended by the agency for processing FOIA requests at the initial request and administrative appeal levels. Includes salaries of FOIA personnel, overhead, and any other FOIA-related expenses. 

*Litigation Cost:* The sum of all costs expended by the agency in litigating FOIA requests. Includes the salaries of personnel involved in FOIA litigation, litigation overhead, attorney fees and costs, and any other FOIA litigation-related expenses.

*Total Cost:* The sum of the processing and litigation costs. Automatically populated for agencies using the 2009 Annual Report Tool to create their NIEM-XML.

*BACKLOG*

*Backlogged Requests:* The number of backlogged requests an agency has pending at the end of the fiscal year. A request is backlogged when it is pending beyond the statutory time period for a response. For requests, the statutory time period is twenty working days from receipt of the perfected request, see 5. U.S.C. § 552(a)(6)(A)(i), unless there are “unusual circumstances” in which case the time period may be extended for an additional ten working days, see id. § 552(a)(6)(B)(i). 

*EXPEDITED PROCESSING*

The FOIA statute requires agencies to “make a determination of whether to provide expedited processing” within ten days (5 U.S.C. § 552(a)(6)(E)(ii)(I). 

When calculating the response time for a request for expedited processing, agencies begin counting calendar days from the day the request for expedited processing is received until the day the agency provides notice to the requester of its determination to either grant or deny the request for expedited processing.

*Requests Granted:* The number of requests for expedited processing granted by the agency.

*Requests Denied:* The number of requests for expedited processing denied by the agency.

*Adjudication Median:* The median number of days taken by the agency to adjudicate requests for expedited processing. 

*Adjudication Average Days:* The average number of days taken by the agency to adjudicate requests for expedited processing.

*Within Ten Days:* The number of requests for expedited processing adjudicated within ten days, the time limit alloted for adjudication by 5 U.S.C. § 552(a)(6)(E)(ii)(I).

*PROCESSED REQUESTS*

*Pending FY Start:* The number of all perfected requests that remain open as of the start of the fiscal year. 

*Pending FY End:* The number of all perfected requests that remain open as of the end of the fiscal year.

*Requests Received:* The number of requests an agency receives in a fiscal year.

*Requests Processed:* The number of requests an agency processes in a fiscal year.

*PENDING REQUESTS*

*Request Type:* Requests have three processing tracks: simple; complex; and expedited. Agencies that have more than these three tracks allocate their various non-expedited tracks into either simple or complex, whichever best matches the the type of requests handled in those additional tracks.

*Pending Requests:* The number of all perfected requests which remained open as of the end of the relevant fiscal year.

*Median Days:* For all perfected requests which remained open as of the end of the relevant fiscal year, the median number of working days they had been pending.

*Average Days:* For all perfected requests which remained open as of the end of the relevant fiscal year, the average number of working days they had been pending.

*APPEAL DISPOSITION*

*Affirmed On Appeal:* The agency's administrative appellate authority affirms the agency's initial action on the request. This includes instances when the initial action is affirmed on modified grounds.

*Partially Affirmed On Appeal:* On appeal, portions of the agency’s initial action on the request are affirmed, but other aspects are either reversed or remanded.

*Reversed On Appeal:* On appeal, the agency’s initial determination is completely reversed and/or the request is completely remanded for further action.

*Appeal Closed - Other:* The agency neither affirms nor reverses/remands (either entirely or partially) the initial request determination, but rather closes the appeal for other reasons (e.g., the request was in litigation, the appeal was a duplicate appeal, the appeal was premature, etc.).

*Number of Appeals:* The number of appeals an agency receives in a given fiscal year.

*AGENCY BUDGETS*

*Total Budget Received:* The total dollars received per annum by each agency. 

*Total Budget Requested:* The total dollars requested per annum by each agency per congressional budget justifications.

*BUDGETS VS. BACKLOGS*

*Component FOIA Budget / Total Agency Budget:* This graph displays the selected component's FOIA budget (taken from the Personnel and Cost Section) divided by the larger agency's total budget (taken from the agency's congressional budget justification). The number displayed is a percentage.

*Component Backlog:* This graph displays the selected component's FOIA backlog, taken from the Backlog Section of the Annual Reports.

Rowv {data-height=200}
-------------------------------------

### ACKNOWLEDGEMENTS

Created by [Kendall McKay](http://www.linkedin.com/in/kendallgmckay) for the [Deportation Research Clinic](https://deportation-research.buffett.northwestern.edu). Project manager: [Professor Jacqueline Stevens.](https://polisci.northwestern.edu/people/core-faculty/jacqueline-stevens.html) 
<br>
<br>
Project support provided by [Aaron Geller](https://faculty.wcas.northwestern.edu/aaron-geller/), [Patrick Zacher](https://www.linkedin.com/in/patrick-zacher/), and John Lee of Northwestern University's [IT Research Computing and Data Services (RCDS)](https://www.it.northwestern.edu/departments/it-services-support/research/).
<br>
<br>
Funding provided by the Northwestern University [Political Science Department](https://polisci.northwestern.edu/), the [Buffet Institute for Global Affairs](https://buffett.northwestern.edu/), and the [Institute for Policy Research](https://www.ipr.northwestern.edu).
